# PhishGuardAI - Phishing URL Detection

[![Pipeline Status](https://gitlab.com/houimliraed/ml-devops/badges/main/pipeline.svg)](https://gitlab.com/houimliraed/ml-devops/-/pipelines)
[![Coverage](https://gitlab.com/houimliraed/ml-devops/badges/main/coverage.svg)](https://gitlab.com/houimliraed/ml-devops/-/graphs/main/charts)

A machine learning-powered web application to detect and classify phishing URLs.

## Setup

### Initial Setup

Before running the application, generate the ML models:

1. **Navigate to the notebooks directory:**
   ```bash
   cd notebooks/
   ```

2. **Run the training notebook:**
   ```bash
   jupyter notebook phishing_detection_training.ipynb
   ```
   Execute all cells to generate the model files in `/backend/app/models/`

### Running the Application

Start the application with Docker Compose:

```bash
docker compose up --build
```

This will:
- Build and start the backend (FastAPI) on http://localhost:4000
- Build and start the frontend (React) on http://localhost:8080

### Project Structure

```
PhishGuardAI/
â”œâ”€â”€ backend/                 # FastAPI backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/            # API endpoints
â”‚   â”‚   â”œâ”€â”€ core/           # Core logic (feature extraction, prediction)
â”‚   â”‚   â”œâ”€â”€ models/         # ML models (generated by notebook)
â”‚   â”‚   â””â”€â”€ schemas/        # Pydantic schemas
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/               # React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”œâ”€â”€ notebooks/              # Jupyter notebooks for training
â”‚   â””â”€â”€ phishing_detection_training.ipynb
â””â”€â”€ docker-compose.yml
```

## Features

- URL feature extraction and analysis
- ML-based phishing detection (RandomForest classifier)
- REST API for predictions
- Interactive web interface
- Docker containerization
- Automated CI/CD pipeline with GitLab

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend  â”‚â”€â”€â”€â”€â”€â–¶â”‚  Nginx Proxy â”‚â”€â”€â”€â”€â”€â–¶â”‚   Backend   â”‚
â”‚ (React+Vite)â”‚      â”‚    (Port 80) â”‚      â”‚  (FastAPI)  â”‚
â”‚  Port 8080  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  Port 4000  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚  ML Models    â”‚
                                           â”‚ (RandomForest)â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Technologies

- **Backend**: FastAPI, Python 3.12, scikit-learn, pandas
- **Frontend**: React 18, Vite, Nginx
- **ML**: RandomForest classifier, feature extraction
- **DevOps**: Docker, Docker Compose, GitLab CI/CD
- **Security**: Secret detection, SAST scanning

## ğŸ“Š CI/CD Pipeline

The project uses a GitLab CI/CD pipeline with 3 stages:

1. **Build**: Docker images for backend and frontend
2. **Test**: Unit tests, security scans (secrets, SAST), Docker Compose validation
3. **Deploy**: Automated deployment to staging/production (manual trigger)

## ğŸŒ Deployment

- **Staging**: https://staging.phishguard.example.com (auto-deploy from `develop` branch)
- **Production**: https://phishguard.example.com (manual deploy from `main` branch)

## ğŸ“ Environment Variables

Create a `.env` file in the root directory:

```env
# Backend
APP_MODULE=app.main:app
PORT=4000

# Frontend
VITE_API_BASE=/api
```

## ğŸ§ª Running Tests

### Backend Tests
```bash
cd backend
pip install -r requirements.txt
pip install pytest pytest-cov pytest-asyncio httpx
pytest tests/ --cov=app --cov-report=html
```

### Frontend Tests
```bash
cd frontend
npm install
npm run test
```

## ğŸ“š Documentation

- [Architecture Documentation](ARCHITECTURE.md)
- [Deployment Guide](DEPLOYMENT.md)
- [User Stories](USER_STORIES.md)
- [API Documentation](http://localhost:4000/docs) (when running)


## ğŸ›¡ï¸ DevSecOps & Security

This project implements automated security guardrails within the CI/CD pipeline to ensure code integrity and infrastructure safety.

### **1. Automated Security Scanning**

Leverages GitLab's managed security templates to "shift security left," catching vulnerabilities during the development phase.

- **SAST & Secret Detection:** Automatically scans source code for vulnerabilities (OWASP Top 10) and prevents the accidental commit of API keys or credentials with dependency check if any third partie library has a known CVE or vulnerability.

```yaml
include:
  - template: Security/Secret-Detection.gitlab-ci.yml
  - template: Security/SAST.gitlab-ci.yml
  - template: Security/Dependency-Scanning.gitlab-ci.yml
```

### **2. Secure Containerization**

Infrastructure is hardened using industry-standard Docker security practices.

- **mTLS Encryption:** Communication between the Docker client and daemon is encrypted using Mutual TLS.

```yaml
variables:
  DOCKER_TLS_CERTDIR: "/certs"
services:
  - docker:24-dind
```

- **Credential Masking:** Registry passwords are piped via `stdin` to prevent sensitive strings from appearing in shell execution logs or process lists.

```yaml
before_script:
  - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin $CI_REGISTRY
```

### **3. Deployment Governance**

Strict rules ensure that only verified code reaches staging and production environments.

- **Manual Gates:** Production and Staging deployments require explicit manual approval by an authorized user.

```yaml
rules:
  - if: $CI_COMMIT_BRANCH == "main"
    when: manual
```

- **Immutable Tagging:** Docker images are tagged with the specific commit SHA, ensuring that the exact code that was tested is the code that is deployed.

```yaml
variables:
  BACKEND_IMAGE: $CI_REGISTRY_IMAGE/backend:$CI_COMMIT_SHORT_SHA
```

### **4. Data Retention & Hygiene**

Minimizes the "attack surface" of stored artifacts.

- **Artifact Expiration:** Build artifacts and environment files are automatically purged after 7 days to prevent long-term storage of sensitive build data.

```yaml
artifacts:
  expire_in: 1 week
```

## Important Notes

- **ML Model Files**: The `backend/app/models/` directory contains generated model files that are NOT tracked in git. These must be regenerated using the training notebook when setting up a fresh environment.
- See `backend/app/models/README.md` for details on generating models.
- **Security**: Never commit secrets or API keys. Use GitLab CI/CD variables for sensitive data.

## ğŸ“§ Contact

**Instructor**: Sonia Ben Aissa (benissasonia@gmail.com)
